<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Schedule Meetup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body class="schedule-page">

<div class="main-content">
    <h2>Schedule Meetup for <span style="color: var(--primary-color);">{{ application_id | e }}</span></h2>

    {% if error %}
        <div class="error" role="alert">{{ error | e }}</div>
    {% endif %}
    {% if success %}
        <div class="success" role="alert">{{ success | e }}</div>
    {% endif %}

    <form method="POST" action="{{ url_for('schedule', application_id=application_id) }}" class="schedule-form" novalidate>
        <div class="form-group">
            <label for="date">Date:</label>
            <input
                type="date"
                id="date"
                name="date"
                value="{{ meeting.get('date', '') }}"
                required
                aria-required="true"
            >
        </div>

        <div class="form-group">
            <label for="time">Time:</label>
            <input
                type="time"
                id="time"
                name="time"
                min="08:00"
                max="22:00"
                value="{{ meeting.get('time', '') }}"
                required
                aria-required="true"
            >
        </div>

        <div class="form-group">
            <label for="phone">Phone Number:</label>
            <input
                type="tel"
                id="phone"
                name="phone"
                placeholder="+60123456789"
                pattern="^\+60[1-9][0-9]{7,10}$"
                title="Please enter a Malaysian phone number starting with +60 followed by 8 to 11 digits"
                value="{{ meeting.get('phone', '') }}"
                inputmode="tel"
                autocomplete="off"
                required
                aria-required="true"
            >
        </div>

        <div class="form-group">
            <label for="state">State:</label>
            <select
                id="state"
                name="state"
                required
                aria-required="true"
                onchange="document.getElementById('final_submit').value='update_state'; this.form.submit();"
            >
                <option value="">-- Select State --</option>
                {% for state in state_cities.keys() %}
                    <option value="{{ state }}" {% if state == selected_state %}selected{% endif %}>{{ state }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="city">City:</label>
            <select
                id="city"
                name="city"
                required
                aria-required="true"
                {% if not selected_state %}disabled{% endif %}
            >
                <option value="">-- Select City --</option>
                {% for city in city_list %}
                    <option value="{{ city }}" {% if meeting.get('city', '') == city %}selected{% endif %}>{{ city }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="notes">Notes (Optional):</label>
            <textarea
                id="notes"
                name="notes"
                placeholder="Add notes about the meetup..."
                rows="4"
            >{{ meeting.get('notes', '') }}</textarea>
        </div>

        <input type="hidden" name="final_submit" id="final_submit" value="">

        <div class="btn-group">
            <button
                type="submit"
                class="btn"
                onclick="document.getElementById('final_submit').value='finalized';"
            >
                Finalize Adoption
            </button>

            <a href="{{ url_for('track_user') }}" class="btn btn-secondary">Go Back</a>
        </div>
    </form>
</div>

</body>
</html>